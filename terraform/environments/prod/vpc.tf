# =============================================================================
# PHASE 1: VPC INFRASTRUCTURE
# =============================================================================
#
# Этот файл вызывает VPC модуль для создания сетевой инфраструктуры.
#
# Что создаётся:
# - VPC (10.0.0.0/16)
# - 2 публичные подсети (для ALB)
# - 2 приватные подсети (для ECS, RDS, Redis)
# - Internet Gateway
# - NAT Gateway (опционально)
# - Security Groups (ALB, ECS, RDS, Redis)
#
# Команды:
#   cd terraform/environments/prod
#   terraform init                        # Инициализация (первый раз)
#   terraform plan -target=module.vpc     # Посмотреть что создастся
#   terraform apply -target=module.vpc    # Применить изменения
# =============================================================================

# -----------------------------------------------------------------------------
# VPC MODULE
# -----------------------------------------------------------------------------
# Вызываем наш модуль из terraform/modules/vpc/
# Модуль - это переиспользуемый набор ресурсов.
#
# Преимущества модулей:
# - Один раз написал - используешь везде (prod, staging, dev)
# - Абстракция сложности - пользователю модуля не нужно знать детали
# - Версионирование - можно зафиксировать версию модуля
# - Тестирование - модуль можно тестировать отдельно

module "vpc" {
  # Путь к модулю (относительный от текущего файла)
  source = "../../modules/vpc"

  # --- Обязательные переменные ---

  # Имя проекта - используется для формирования имён ресурсов
  project_name = var.project_name

  # Окружение - prod/staging/dev
  environment = var.environment

  # --- Опциональные переменные (с значениями по умолчанию) ---

  # CIDR блок для VPC
  # По умолчанию: 10.0.0.0/16 (65,536 IP адресов)
  vpc_cidr = var.vpc_cidr

  # Создавать ли NAT Gateway
  # true = ~$32/месяц, но контейнеры могут ходить в интернет
  # false = $0, но нужны VPC Endpoints для AWS сервисов
  create_nat_gateway = var.create_nat_gateway
}
